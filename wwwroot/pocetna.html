<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PL</title>
</head>

<body>
    <div class="header">
        <h1>Premier League</h1>
    </div>
    <div class="glavna">
        <div class="tabela">
                    <div class="panel-heading">Tabela</div>
                    <table id="klubovi" class="table">
                        <thead>
                            <tr>
                                <th>Naziv</th>
                                <th>Bodovi</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
        </div>
        <div class="utakmice">
            <form class="navbar-form" id="utakmice"> 
                <div class="row">
                            <div class="panel-heading">Utakmice</div>
                                <input list="KluboviUtakmice" name="klub" class="dropdown">
                                 <datalist id="KluboviUtakmice">
                                 </datalist>
                            <button class="btn" type="submit">Prikazi utakmice</button>
                            <table id="utakmice" class="table">
                                <thead>
                                    <tr>
                                        <th>Domacin</th>
                                        <th></th>
                                        <th></th>
                                        <th>Gost</th>
                                        <th>Kolo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                </div>
            </form>
        </div>
        <div class="treca">
            <div class="vesti">
                <form class="navbar-form" id="vesti">
                    <div class="row">
                        <div class="panel-heading">Vesti</div>
                        <input list="KluboviVesti" name="klub" class="dropdown">
                        <datalist id="KluboviVesti">
                        </datalist>
                        <button class="btn" type="submit">Prikazi vesti</button>
                        <table id="vesti" class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Klub</th>
                                    <th>Vest</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>
            <div class="panel-heading">Rad sa nalogom</div>
            <div>
                <label class="label-naslov">
                    Promena omlijenog kluba
                </label>
                <form class="navbar-form" id="promenakluba">

                    <div class="form-group">
                        <label class="label">
                            Klub:
                        </label>
                        <input list="KluboviPromena" name="klub" class="dropdown">
                        <datalist id="KluboviPromena">
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label class="label">
                            Sifra:
                        </label>
                        <input type="password" value="" placeholder="" class="form-control" name="password">
                    </div>
                    <button class="btn" type="submit">Promeni omiljeni klub</button>
                </form>
            </div>
            <div>
                <label class="label-naslov">
                    Promena sifre
                </label>
                <form class="navbar-form" id="promenasifre">

                    <div class="form-group">
                        <label class="label">
                            Nova sifra:
                        </label>
                        <input type="password" value="" placeholder="" class="form-control" name="novipassword">
                    </div>

                    <div class="form-group">
                        <label class="label">
                            Ponovite novu sifru:
                        </label>
                        <input type="password" value="" placeholder="" class="form-control" name="novipasswordrepeat">
                    </div>

                    <div class="form-group">
                        <label class="label">
                            Stara sifra:
                        </label>
                        <input type="password" value="" placeholder="" class="form-control" name="staripassword">
                    </div>
                    <button class="btn" type="submit">Promeni sifru</button>
                </form>
            </div>
            <div>
                <label class="label-naslov">
                    Brisanje korisnika
                </label>
                <form class="navbar-form" id="brisanjekorisnika">

                    <div class="form-group">
                        <label class="label">
                            Sifra:
                        </label>
                        <input type="password" value="" placeholder="" class="form-control" name="password">
                    </div>
                    <button class="btn" type="submit">Obrisi korisnika</button>
                </form>
            </div>
        </div>
    </div>

    <style type="text/css">
        .header {
            text-align: center;
            background: #38043c;
            color: white;
            font-size: 18px;
            width: 100%;
            position: fixed;
            top: 0px;
            left: 0px;
            right: 0px;
            height: 60px;
            padding: 10px;
            border: none;
            margin: auto;
        }
        .glavna {
            position:fixed;
            width:100%;
            top:90px;
        }
        .tabela{
            position:inherit;
            width:30%;
            left:1%;
        }
        .utakmice {
            position: inherit;
            width: 30%;
            left: 35%;
            right:35%;
        }
        .treca {
            position: inherit;
            width: 30%;
            right: 1%;
        }
        .panel-heading {
            background: #38043c;
            color: white;
            font-size: 20px;
            text-align:center;
        }
        .table {
            table-layout: auto;
            width: 100%;
            border: 1px solid #38043c;
            text-align:center;
        }
        td,th {
            border: 1px solid #38043c;
            padding:0;
        }
        .dropdown {
            color: #38043c;
            font-size: 15px;
            border: 2px solid #38043c;
            margin: 3px;
        }
        .btn {
            color: #38043c;
            font-size: 15px;
            border: 2px solid #38043c;
        }
        .form-control {
            color: #38043c;
            font-size: 15px;
            border: 2px solid #38043c;
            margin: 3px;
        }
        .label-naslov {
            color: #38043c;
            font-size: 18px;
        }
        .label {
            color: #38043c;
            font-size: 15px;
        }

    </style>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        const user = localStorage.getItem("username");
        var omiljeniklub;
        $(function () {

            function omiljeniKlub() {
                $.get("/omiljeniKlub/" + encodeURIComponent(user), function (data) {
                    if (!data || data.length == 0) return;
                    omiljeniklub = data;
                });
                return false;
            }
            omiljeniKlub();



            function tabela() {
                $.get("/tabela",
                    function (data) {
                        const t = $("table#klubovi tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (klub) {
                            $("<tr><td class='klub'>" + klub.naziv
                                + "</td><td>" + klub.bodovi
                                + "</td></tr>").appendTo(t)
                        });
                    }, "json");
                return false;
            }

            function sviKlubovi() {
                $.get("/sviKlubovi",
                    function (data) {
                        const t1 = $("datalist#KluboviUtakmice").empty();
                        const t2 = $("datalist#KluboviVesti").empty();
                        const t3 = $("datalist#KluboviPromena").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (str) {
                            $("<option>" + str + "</option>").appendTo(t1)
                            $("<option>" + str + "</option>").appendTo(t2)
                            $("<option>" + str + "</option>").appendTo(t3)
                        });
                    }, "json");
                return false;
            }


            function utakmice() {
                var klub = $("#utakmice").find("input[name=klub]").val();
                if (klub == '')
                    klub = omiljeniklub;
                $.get("/utakmice/" + encodeURIComponent(klub),
                    function (data) {
                        const t = $("table#utakmice tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (utakmica) {
                            $("<tr><td class='utakmica'>" + utakmica.domacin
                                + "</td><td>" + utakmica.domacin_golovi
                                + "</td><td>" + utakmica.gost_golovi
                                + "</td><td>" + utakmica.gost
                                + "</td><td>" + utakmica.kolo
                                + "</td></tr>").appendTo(t)
                        });
                    }, "json");
                return false;
            }



            function vesti() {
                var klub = $("#vesti").find("input[name=klub]").val();
                if (klub == '')
                    klub = omiljeniklub;
                $.get("/vesti/" + encodeURIComponent(klub),
                    function (data) {
                        const t = $("table#vesti tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (vest) {
                            $("<tr><td class='utakmica'>" + vest.klub
                                + "</td><td>" + vest.tekst
                                + "</td></tr>").appendTo(t)
                        });
                    }, "json");
                return false;
            }

            function promeniklub() {
                const klub = $("#promenakluba").find("input[name=klub]").val();
                const sifra = $("#promenakluba").find("input[name=password]").val();
                $.ajax({
                    type: 'PUT', url: '/promeniklub/' + encodeURIComponent(klub) + '/' + encodeURIComponent(sifra) + '/' + encodeURIComponent(user), complete: function (data) {
                        if (data.responseJSON) {
                            window.alert("Uspesna promena kluba");
                        }
                        else {
                            window.alert("Pogresna sifra");
                        }
                    }
                });
            }

            function promenisifru() {
                const novasifra = $("#promenasifre").find("input[name=novipassword]").val();
                const novasifrarepeat = $("#promenasifre").find("input[name=novipasswordrepeat]").val();
                const starasifra = $("#promenasifre").find("input[name=staripassword]").val();
                if (novasifra == novasifrarepeat) {
                    $.ajax({
                        type: 'PUT', url: '/promenisifru/' + encodeURIComponent(novasifra) + '/' + encodeURIComponent(starasifra) + '/' + encodeURIComponent(user), complete: function (data) {
                            if (data.responseJSON) {
                                window.alert("Uspesna promena sifre");
                            }
                            else {
                                window.alert("Pogresna sifra");
                            }
                        }
                    });
                }
                else {
                    window.alert("Sifre se ne poklapaju");
                }

            }

            function obrisikorisnika() {
                const sifra = $("#brisanjekorisnika").find("input[name=password]").val();
                $.ajax({
                    type: 'DELETE', url: '/obrisikorisnika/' + encodeURIComponent(user) + '/' + encodeURIComponent(sifra), complete: function (data) {
                        if (data.responseJSON) {
                            window.alert("Korisnik uspesno obrisan");
                            window.location.assign("index.html");
                        }
                        else {
                            window.alert("Pogresna sifra");
                        }
                    }
                });
            }

            setTimeout(function () { utakmice(); }, 50);
            $("#utakmice").submit(utakmice);
            setTimeout(function () { vesti(); }, 50);
            $("#vesti").submit(vesti);
            $("#promenakluba").submit(promeniklub);
            $("#promenasifre").submit(promenisifru);
            $("#brisanjekorisnika").submit(obrisikorisnika);
            sviKlubovi();
            tabela();
        })</script>
</body>
</html>
